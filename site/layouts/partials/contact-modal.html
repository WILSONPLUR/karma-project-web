<!-- Contact Modal -->
<div id="contactModal" class="modal-overlay hidden">
  <div class="modal-container">
    <div class="modal-content">
      <!-- Close Button -->
      <button class="modal-close" id="closeModal" aria-label="Close modal">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Modal Header -->
      <div class="modal-header">
        <h2 class="modal-title font-['Unbounded']">
          <span class="title-highlight">З</span>алиште свій запит і ми зв'яжемось з Вами<br>
          та повідомимо про актуальні ціни
        </h2>
      </div>

      <!-- Contact Form -->
      <form class="contact-form" id="contactForm">
        <div class="form-row">
          <div class="form-group">
            <input type="text" id="userName" name="userName" placeholder="Ваше ім'я" class="form-input" required>
          </div>
          <div class="form-group">
            <input type="tel" id="userPhone" name="userPhone" placeholder="+380" class="form-input" required>
          </div>
        </div>

        <div class="form-group">
          <input type="number" id="quantity" name="quantity" placeholder="Кількість стеків, яку плануєте замовити" class="form-input" required>
        </div>

        <div class="form-group">
          <textarea id="message" name="message" placeholder="Ваше повідомлення" class="form-textarea" rows="4"></textarea>
        </div>

        <div class="contact-info">
          <div class="contact-wrapper">
            <p class="contact-label">Наші контакти для зв'язку:</p>
          <div class="contact-details">
            <a href="tel:+380956156713" class="contact-phone">+380 95 61 56713</a>
            <a href="mailto:info@karma.flights" class="contact-email">info@karma.flights</a>
          </div>
          </div>
          <button type="submit" class="submit-button">
            Відправити
          </button>
        </div>

      </form>
    </div>
  </div>
</div>

<!-- Modal Trigger Button (for testing) -->
<button id="openModal" class="open-modal-btn">
  Відкрити модальне вікно
</button>

<script>
// Inline modal functionality to ensure it's always available
(function() {
  let modalInstance = null;

  class ContactModal {
    constructor() {
      this.modal = document.getElementById('contactModal');
      this.openBtn = document.getElementById('openModal');
      this.closeBtn = document.getElementById('closeModal');
      this.form = document.getElementById('contactForm');
      
      this.init();
    }

    init() {
      if (!this.modal) return;
      
      // Event listeners
      if (this.openBtn) {
        this.openBtn.addEventListener('click', () => this.open());
      }
      
      if (this.closeBtn) {
        this.closeBtn.addEventListener('click', () => this.close());
      }
      
      // Close on overlay click
      this.modal.addEventListener('click', (e) => {
        if (e.target === this.modal) {
          this.close();
        }
      });
      
      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
          this.close();
        }
      });
      
      // Form submission
      if (this.form) {
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));
      }
      
      // Phone number formatting
      const phoneInput = document.getElementById('userPhone');
      if (phoneInput) {
        phoneInput.addEventListener('input', (e) => this.formatPhoneNumber(e));
      }
    }

    open() {
      this.modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Focus first input
      const firstInput = this.modal.querySelector('.form-input');
      if (firstInput) {
        setTimeout(() => firstInput.focus(), 100);
      }
    }

    close() {
      this.modal.classList.add('hidden');
      document.body.style.overflow = '';
      
      // Reset form
      if (this.form) {
        this.form.reset();
      }
    }

    formatPhoneNumber(e) {
      let value = e.target.value.replace(/\D/g, '');
      
      // Ensure it starts with 380 if user types numbers
      if (value && !value.startsWith('380')) {
        if (value.startsWith('0')) {
          value = '38' + value;
        } else if (value.length > 0) {
          value = '380' + value;
        }
      }
      
      // Format as +380 XX XXX XX XX
      if (value.length >= 3) {
        let formatted = '+' + value.substring(0, 3);
        if (value.length > 3) {
          formatted += ' ' + value.substring(3, 5);
        }
        if (value.length > 5) {
          formatted += ' ' + value.substring(5, 8);
        }
        if (value.length > 8) {
          formatted += ' ' + value.substring(8, 10);
        }
        if (value.length > 10) {
          formatted += ' ' + value.substring(10, 12);
        }
        e.target.value = formatted;
      } else if (value.length === 0) {
        e.target.value = '+380';
      }
    }

    handleSubmit(e) {
      e.preventDefault();
      
      const formData = new FormData(this.form);
      const data = {
        name: formData.get('userName'),
        phone: formData.get('userPhone'),
        quantity: formData.get('quantity'),
        message: formData.get('message')
      };
      
      // Basic validation
      if (!data.name.trim()) {
        this.showError('Будь ласка, введіть ваше ім\'я');
        return;
      }
      
      if (!data.phone.trim() || data.phone.length < 13) {
        this.showError('Будь ласка, введіть коректний номер телефону');
        return;
      }
      
      if (!data.quantity || data.quantity <= 0) {
        this.showError('Будь ласка, введіть кількість стеків');
        return;
      }
      
      // Simulate form submission
      this.submitForm(data);
    }

    async submitForm(data) {
      const submitBtn = this.form.querySelector('.submit-button');
      const originalText = submitBtn.textContent;
      
      // Show loading state
      submitBtn.textContent = 'Відправляємо...';
      submitBtn.disabled = true;
      
      try {
        // Here you would typically send data to your server
        // For now, we'll simulate a successful submission
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        this.showSuccess('Дякуємо! Ваш запит успішно відправлено. Ми зв\'яжемось з вами найближчим часом.');
        
        setTimeout(() => {
          this.close();
        }, 2000);
        
      } catch (error) {
        this.showError('Виникла помилка при відправці. Спробуйте ще раз.');
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    }

    showError(message) {
      this.showMessage(message, 'error');
    }

    showSuccess(message) {
      this.showMessage(message, 'success');
    }

    showMessage(message, type) {
      // Remove existing messages
      const existingMessage = this.modal.querySelector('.form-message');
      if (existingMessage) {
        existingMessage.remove();
      }
      
      // Create message element
      const messageEl = document.createElement('div');
      messageEl.className = `form-message form-message--${type}`;
      messageEl.textContent = message;
      
      // Insert before submit button
      const submitBtn = this.form.querySelector('.submit-button');
      submitBtn.parentNode.insertBefore(messageEl, submitBtn);
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        if (messageEl.parentNode) {
          messageEl.remove();
        }
      }, 5000);
    }
  }

  // Global function to open modal
  window.openContactModal = function() {
    if (!modalInstance) {
      modalInstance = new ContactModal();
    }
    modalInstance.open();
  };

  // Initialize when DOM is ready
  function initModal() {
    if (!modalInstance && document.getElementById('contactModal')) {
      modalInstance = new ContactModal();
    }
  }

  // Initialize based on document ready state
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initModal);
  } else {
    initModal();
  }
})();
</script>
